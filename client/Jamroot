
import modules ;

path-constant TOP : . ;
path-constant SRC : src ;
path-constant OBJ : obj ;
path-constant BIN : bin ;
path-constant TEST : test ;
path-constant DEPENDS : depends ;

path-constant MISSIO_ROOT : $(DEPENDS)/missio ;

BOOST_ROOT = [ modules.peek : BOOST_ROOT ] ;

if ! $(BOOST_ROOT)
{
    echo ;
    echo "Required environment variable BOOST_ROOT is not set" ;
    echo "Please set it to point to the root of BOOST distribution" ;
    exit ;
}

use-project /boost : $(BOOST_ROOT) ;

use-project /missio : $(MISSIO_ROOT) ;

#use-project /cpp-netlib : $(DEPENDS)/cpp-netlib ;

project /chat/informer
    :
        requirements
        <link>static
        <runtime-link>static
        <threading>multi
        <warnings>all
        <include>$(SRC)
        <include>$(BOOST_ROOT)
        <include>$(DEPENDS)/missio
        <include>$(DEPENDS)/cpp-netlib
        <define>BOOST_ALL_NO_LIB
        <define>BOOST_FILESYSTEM_VERSION=3
        <define>BOOST_FILESYSTEM_NO_DEPRECATE
        <toolset>msvc:<define>WIN32
        <toolset>msvc:<define>_WIN32
        <toolset>msvc:<define>UNICODE
        <toolset>msvc:<define>_UNICODE
        <toolset>msvc:<define>NOMINMAX
        <toolset>msvc:<define>_WIN32_WINNT=0x0501
        <toolset>msvc:<define>WIN32_LEAN_AND_MEAN
        <toolset>msvc:<define>_SCL_SECURE_NO_WARNINGS
        <toolset>msvc:<define>_SCL_SECURE_NO_DEPRECATE
        <toolset>msvc:<define>_CRT_SECURE_NO_WARNINGS
        <toolset>msvc:<define>_CRT_SECURE_NO_DEPRECATE
        <toolset>msvc:<define>_CRT_NONSTDC_NO_DEPRECATE
        <toolset>msvc:<cxxflags>/wd4100
        <toolset>msvc:<cxxflags>/wd4127
        <toolset>msvc:<cxxflags>/wd4244
        <toolset>msvc:<cxxflags>/wd4345
        <toolset>msvc:<cxxflags>/wd4512
        <toolset>msvc:<cxxflags>/wd4702
        <toolset>msvc:<cxxflags>/wd4714
        <toolset>msvc:<cxxflags>/wd4800
    :
        default-build release debug
    :
        source-location $(SRC)
    :
        build-dir $(OBJ)
    ;

use-project /chat/informer/utility/test : $(TEST)/utility ;
use-project /chat/informer/crypto/test : $(TEST)/crypto ;

build-project $(TEST)/utility ;
build-project $(TEST)/crypto ;

# Windows libraries
lib psapi ;
lib ws2_32 ;
lib shlwapi ;

exe chat_informer
    :
        ## sources ##
        [ glob-tree *.cpp *.c : .svn ]
        /missio/unicode//missio_unicode
        /missio/logging//missio_logging
        /boost/system//boost_system
        /boost/thread//boost_thread
        /boost/date_time//boost_date_time
        /boost/filesystem//boost_filesystem
    :
        ## requirements ##
        <include>$(DEPEND)/wtl
        <define>_WTL_USE_CSTRING
        <define>_WTL_NO_AUTOMATIC_NAMESPACE
        <library>shlwapi
        <library>ws2_32
        <library>psapi
    ;

install install-chat-informer
    :
        ## sources ##
        chat_informer
    :
        ## build requirements ##
        <variant>debug:<location>$(BIN)/debug
        <variant>profile:<location>$(BIN)/profile
        <variant>release:<location>$(BIN)/release
    ;
